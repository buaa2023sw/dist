import{n as h,a as n}from"./index.84c01e78.js";const m={name:"Branch",data(){return{projId:this.$route.params.projid,repoId:this.$route.params.repoid,branchName:this.$route.params.branchname,proj:null,repos:null,repo:null,branches:null,commitHistory:null,daily:{col:4,color:"red",title:"\u8FC7\u53BB\u4E09\u5341\u65E5\u5185\u7684\u63D0\u4EA4",label:[],data:[]},monthly:{col:4,color:"blue",title:"\u8FC7\u53BB\u4E00\u5E74\u5185\u7684\u63D0\u4EA4",label:[],data:[]},yearly:{col:4,color:"green",title:"\u8FC7\u53BB\u5341\u5E74\u5185\u7684\u63D0\u4EA4",label:[],data:[]}}},created(){this.proj=this.user.projects.reduce((a,e)=>e.id==this.projId?e:a,null),this.proj===null&&alert("proj not found"),n.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.projId}).then(a=>{a.data.errcode===0?(this.repos=a.data.data.map((e,t,r)=>{let i=e.repoRemotePath.split("/");return{id:e.repoId,user:i[0],repo:i[1],intro:e.repoIntroduction}}),this.repo=this.repos.reduce((e,t)=>t.id==this.repoId?t:e,null),this.repo===null&&alert("repo not found")):alert("/api/develop/getBindRepos error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getBindRepos error"+a)}),n.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.repoId,projectId:this.projId}).then(a=>{a.data.errcode===0?(this.branches=a.data.data.map((t,r,i)=>t.branchName),this.branches.reduce((t,r)=>r==this.branchName?r:t,null)===null&&alert("branch "+this.branchName+" not found in branches "+this.branches)):alert("/api/develop/getBranches error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getBranches error"+a)}),n.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.projId,repoId:this.repoId,branchName:this.branchName}).then(a=>{a.data.errcode===0?(this.commitHistory=a.data.data.map((e,t,r)=>({id:t,author:e.author,authorEmail:e.authorEmail,commithash:e.commithash,commitMessage:e.commitMessage,commitTime:e.commitTime})),this.prep_data()):alert("/api/develop/getCommitHistory error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getBindRepos error"+a)})},inject:{user:{default:null}},methods:{prep_data(){let a=this.commitHistory[this.commitHistory.length-1],e=new Date(a.commitTime);e.setDate(e.getDate()-1);let t={},r=new Date;for(;r>=e;){let l=e.toLocaleDateString();t[l]=0,e.setDate(e.getDate()+1)}this.commitHistory.forEach((l,d,c)=>{let o=new Date(l.commitTime).toLocaleDateString();t[o]===void 0?t[o]=1:t[o]+=1}),this.daily.label=Object.keys(t);for(let l=1;l<this.daily.label.length-1;l++)this.daily.label[l]="";this.daily.data=Object.values(t);let i={};for(e=new Date(a.commitTime),e.setMonth(e.getMonth()-1);r>=e;){let l=e.getFullYear()+"-"+(e.getMonth()+1);i[l]=0,e.setMonth(e.getMonth()+1)}this.commitHistory.forEach((l,d,c)=>{let o=new Date(l.commitTime).getFullYear()+"-"+(new Date(l.commitTime).getMonth()+1);i[o]===void 0?i[o]=1:i[o]+=1}),this.monthly.label=Object.keys(i),this.monthly.data=Object.values(i);let s={};for(e=new Date(a.commitTime),e.setFullYear(e.getFullYear()-1);r>=e;){let l=e.getFullYear();s[l]=0,e.setFullYear(e.getFullYear()+1)}this.commitHistory.forEach((l,d,c)=>{let o=new Date(l.commitTime).getFullYear();s[o]===void 0?s[o]=1:s[o]+=1}),this.yearly.label=Object.keys(s),this.yearly.data=Object.values(s)}}};var p=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("h1",[e._v("\u5206\u652F\u8BE6\u60C5 - "+e._s(e.branchName))]),t("v-row",[t("v-col",{staticClass:"px-3",attrs:{cols:"3"}},[t("h2",[e._v("\u63D0\u4EA4\u8BB0\u5F55")]),t("v-list",e._l(e.commitHistory,function(r){return t("v-list-item",{key:r.id},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(r.commitMessage))]),t("v-list-item-subtitle",[e._v(e._s(new Date(r.commitTime).toLocaleString())+" - "+e._s(r.commithash.slice(0,6))+" - "+e._s(r.author))])],1)],1)}),1)],1),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"9"}},[t("v-container",{attrs:{fluid:""}},[t("v-row",{attrs:{dense:""}},e._l([e.daily,e.monthly,e.yearly],function(r,i){return t("v-col",{key:i,attrs:{cols:r.col}},[t("v-card",{staticClass:"text-center align-center",attrs:{color:r.color}},[t("v-sparkline",{attrs:{labels:r.label,value:r.data,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),t("v-card-title",[e._v("\u4ECE "+e._s(r.label[0])+" \u5230 "+e._s(r.label[r.label.length-1])+" \u7684\u63D0\u4EA4")])],1)],1)}),1),t("br"),t("v-divider"),t("br"),t("v-row",{attrs:{dense:""}})],1)],1)],1)],1)},u=[],v=h(m,p,u,!1,null,"aebe20a9",null,null);const _=v.exports;export{_ as default};
