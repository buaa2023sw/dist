import{n,a as d,l as o,e as i,k as l,t as c}from"./index.9ac49d84.js";import{u as r}from"./util.1fa49f35.js";const u={name:"profile",inject:{user:{default:null},reload:{default:null},updateUser:{default:null}},data(){return{showedUserName:"",userInfo:{username:"",email:"",avatar:""},showChangePassword:!1,oldPassword:"",newPassword:"",confirmNewPassword:"",registerRules:{user_oldPassword:[function(t){return/^.+$/.test(t)||"\u65E7\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"}],user_newPassword:[function(t){return/^.{6,}$/.test(t)||"\u65B0\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u4E3A6\u4F4D"}],user_confirmNewPassword:[function(t){return/^.{6,}$/.test(t)||"\u786E\u8BA4\u5BC6\u7801\u957F\u5EA6\u81F3\u5C11\u4E3A6\u4F4D"}]}}},created(){this.showProfile()},methods:{getIdenticon:d,valid(){return/^.+$/.test(this.oldPassword)&&/^.{6,}$/.test(this.newPassword)&&/^.{6,}$/.test(this.confirmNewPassword)},showProfile(){o.post("/api/showProfile",{userId:this.user.id}).then(t=>{console.log(t),t.data.errcode===1?this.$message({type:"error",message:"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25"}):(this.showedUserName=t.data.data.userName,this.userInfo.username=t.data.data.userName,this.userInfo.email=t.data.data.userEmail)}).catch(t=>{console.error(t),this.userMessages=null})},save(){const t=this.userInfo.username,e=this.userInfo.email;if(!r.trim(t)||!r.trim(e)){this.$message({type:"error",message:"\u7528\u6237\u540D\u6216\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A"});return}console.log(t),console.log(e),o.post("/api/editProfile",{userId:this.user.id,userName:t,userEmail:e}).then(s=>{console.log(1111111),s.data.errcode===0?(this.$message({type:"success",message:"\u4FDD\u5B58\u6210\u529F"}),this.showProfile(),console.log(s.data.data),i.set("user",JSON.stringify(s.data.data)),this.updateUser(),console.log("1241442342"),console.log(i.get("user")),console.log(this.user)):s.data.errcode===1?this.$message({type:"error",message:"\u4FDD\u5B58\u5931\u8D25"}):s.data.errcode===2?this.$message({type:"error",message:"\u8BE5\u90AE\u7BB1\u5DF2\u88AB\u4F7F\u7528"}):s.data.errcode===3&&this.$message({type:"error",message:"\u8BE5\u7528\u6237\u540D\u5DF2\u88AB\u4F7F\u7528"})}).catch(s=>{console.log(s)})},async changePassword(){if(!r.trim(this.oldPassword)){this.$message({type:"error",message:"\u539F\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"});return}if(!r.trim(this.newPassword)){this.$message({type:"error",message:"\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"});return}if(this.newPassword!==this.confirmNewPassword){this.$message({type:"error",message:"\u8BF7\u4FDD\u8BC1\u65B0\u5BC6\u7801\u548C\u786E\u8BA4\u65B0\u5BC6\u7801\u5185\u5BB9\u4E00\u81F4"});return}let t=l.exports.sha256(this.oldPassword),e=l.exports.sha256(this.newPassword);console.log(t),console.log(e),o.post("/api/user/information/password",{userId:this.user.id,oldPassword:t,newPassword:e}).then(s=>{s.data.errcode===1?this.$message({type:"error",message:"\u8BF7\u91CD\u65B0\u786E\u8BA4\u539F\u5BC6\u7801"}):(this.showChangePassword=!1,this.oldPassword="",this.newPassword="",this.confirmNewPassword="",this.$message({type:"success",message:"\u5BC6\u7801\u4FEE\u6539\u6210\u529F"}))}).catch(s=>{console.log(s)})},openChangePasswordDialog(){this.oldPassword="",this.newPassword="",this.confirmNewPassword="",this.showChangePassword=!0},closeChangePasswordDialog(){this.showChangePassword=!1,this.oldPassword="",this.newPassword="",this.confirmNewPassword=""},back(){this.$router.go(-1)},getRadialGradient:c.getRadialGradient}};var w=function(){var e=this,s=e._self._c;return s("v-container",{style:e.getRadialGradient(e.user.topic),attrs:{fluid:"","fill-height":""}},[s("v-row",{attrs:{align:"center",justify:"center"}},[s("v-col",{attrs:{cols:"12"}},[s("v-card",{staticClass:"mx-auto",attrs:{width:"800",height:"300",padding:"16"}},[s("v-img",{attrs:{src:e.getIdenticon(this.user.name,100,"user"),height:"300",gradient:"to bottom, rgba(255,255,255,.3), rgba(255,255,255,.9) 30%, rgba(255,255,255,.9) 70%, rgba(255,255,255,.3)"}},[s("v-card-title",{staticClass:"headline font-weight text-left"},[e._v("\u67E5\u770B\u4E2A\u4EBA\u4FE1\u606F")]),s("v-divider"),s("v-row",{attrs:{align:"center"}},[s("v-col",{staticClass:"text-center",attrs:{cols:"3"}},[s("v-avatar",{attrs:{color:"indigo",size:"100"}},[s("v-img",{attrs:{src:e.getIdenticon(this.user.name,100,"user")}})],1),s("strong",{staticClass:"d-block"},[e._v(" "+e._s(e.userInfo.username)+" ")])],1),s("v-col",{attrs:{cols:"8"}},[s("v-text-field",{attrs:{label:"\u7528\u6237\u540D",outlined:"",dense:""},model:{value:e.userInfo.username,callback:function(a){e.$set(e.userInfo,"username",a)},expression:"userInfo.username"}}),s("v-text-field",{attrs:{label:"\u90AE\u7BB1",outlined:"",dense:""},model:{value:e.userInfo.email,callback:function(a){e.$set(e.userInfo,"email",a)},expression:"userInfo.email"}})],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"red",text:""},on:{click:e.openChangePasswordDialog}},[e._v("\u4FEE\u6539\u5BC6\u7801")]),s("v-btn",{attrs:{color:"primary",text:""},on:{click:e.save}},[e._v("\u4FDD\u5B58")]),s("v-btn",{attrs:{color:"primary",text:""},on:{click:e.back}},[e._v("\u8FD4\u56DE")])],1)],1)],1)],1)],1),e.showChangePassword?s("v-dialog",{attrs:{width:"500"},model:{value:e.showChangePassword,callback:function(a){e.showChangePassword=a},expression:"showChangePassword"}},[[s("v-container",{staticClass:"pa-0"},[s("v-card",[s("v-card-title",{staticClass:"headline font-weight text-left"},[e._v("\u4FEE\u6539\u5BC6\u7801")]),s("v-divider"),s("v-card-text",[s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u539F\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{rules:e.registerRules.user_oldPassword,outlined:"",dense:"",type:"password"},model:{value:e.oldPassword,callback:function(a){e.oldPassword=a},expression:"oldPassword"}})],1)])],1),s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u65B0\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{rules:e.registerRules.user_newPassword,outlined:"",dense:"",type:"password"},model:{value:e.newPassword,callback:function(a){e.newPassword=a},expression:"newPassword"}})],1)])],1),s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u786E\u8BA4\u65B0\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{rules:e.registerRules.user_confirmNewPassword,outlined:"",dense:"",type:"password"},model:{value:e.confirmNewPassword,callback:function(a){e.confirmNewPassword=a},expression:"confirmNewPassword"}})],1)])],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"red",text:""},on:{click:e.closeChangePasswordDialog}},[e._v("\u53D6\u6D88")]),s("v-btn",{attrs:{color:"blue",text:"",disabled:!e.valid()},on:{click:e.changePassword}},[e._v("\u786E\u8BA4\u4FEE\u6539")])],1)],1)],1)]],2):e._e()],1)},h=[],f=n(u,w,h,!1,null,"bbf85fce",null,null);const v=f.exports;export{v as default};
