System.register(["./index-legacy.b8800098.js","./echarts-legacy.8bee7ecb.js","./echarts-legacy.4229f51f.js"],(function(t,e){"use strict";var r,a,o,i,s=document.createElement("style");return s.textContent="",document.head.appendChild(s),{setters:[function(t){r=t.n,a=t.u},function(t){o=t.e},function(t){i=t.e}],execute:function(){t("default",r({name:"Branch",data:function(){return{projId:this.$route.params.projid,repoId:this.$route.params.repoid,branchName:this.$route.params.branchname,proj:null,repos:null,repo:null,branches:null,commitHistory:null,daily:{col:4,color:"#FFCDD2",title:"过去三十日内的提交",label:[],data:[]},monthly:{col:4,color:"#B2EBF2",title:"过去一年内的提交",label:[],data:[]},yearly:{col:4,color:"#C8E6C9",title:"过去十年内的提交",label:[],data:[]},perUser:[]}},created:function(){var t=this;this.proj=this.user.projects.reduce((function(e,r){return r.id==t.projId?r:e}),null),null===this.proj&&alert("proj not found"),a.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.projId}).then((function(e){0===e.data.errcode?(t.repos=e.data.data.map((function(t,e,r){var a=t.repoRemotePath.split("/");return{id:t.repoId,user:a[0],repo:a[1],intro:t.repoIntroduction}})),t.repo=t.repos.reduce((function(e,r){return r.id==t.repoId?r:e}),null),null===t.repo&&alert("repo not found")):alert("/api/develop/getBindRepos error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getBindRepos error"+t)})),a.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.repoId,projectId:this.projId}).then((function(e){0===e.data.errcode?(t.branches=e.data.data.map((function(t,e,r){return t.branchName})),null===t.branches.reduce((function(e,r){return r==t.branchName?r:e}),null)&&alert("branch "+t.branchName+" not found in branches "+t.branches)):alert("/api/develop/getBranches error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getBranches error"+t)})),a.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.projId,repoId:this.repoId,branchName:this.branchName}).then((function(e){0===e.data.errcode?(t.commitHistory=e.data.data.map((function(t,e,r){return{id:e,author:t.author,authorEmail:t.authorEmail,commithash:t.commithash,commitMessage:t.commitMessage,commitTime:t.commitTime}})),t.prep_data_in_time_scope(),t.prep_data_in_user_scope(),t.draw_pie_chart()):alert("/api/develop/getCommitHistory error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getCommitHistory error"+t)}))},inject:{user:{default:null}},methods:{prep_data_in_time_scope:function(){var t=this.commitHistory[this.commitHistory.length-1],e=new Date(t.commitTime);e.setDate(e.getDate()-1);for(var r={},a=new Date;a>=e;){var o=e.toLocaleDateString();r[o]=0,e.setDate(e.getDate()+1)}this.commitHistory.forEach((function(t,e,a){var o=new Date(t.commitTime).toLocaleDateString();void 0===r[o]?r[o]=1:r[o]+=1})),this.daily.label=Object.keys(r);for(var i=1;i<this.daily.label.length-1;i++)this.daily.label[i]="";this.daily.data=Object.values(r);var s={};for((e=new Date(t.commitTime)).setMonth(e.getMonth()-1);a>=e;){var l=e.getFullYear()+"-"+(e.getMonth()+1);s[l]=0,e.setMonth(e.getMonth()+1)}this.commitHistory.forEach((function(t,e,r){var a=new Date(t.commitTime).getFullYear()+"-"+(new Date(t.commitTime).getMonth()+1);void 0===s[a]?s[a]=1:s[a]+=1})),this.monthly.label=Object.keys(s),this.monthly.data=Object.values(s);var n={};for((e=new Date(t.commitTime)).setFullYear(e.getFullYear()-1);a>=e;){var c=e.getFullYear();n[c]=0,e.setFullYear(e.getFullYear()+1)}this.commitHistory.forEach((function(t,e,r){var a=new Date(t.commitTime).getFullYear();void 0===n[a]?n[a]=1:n[a]+=1})),this.yearly.label=Object.keys(n),this.yearly.data=Object.values(n)},prep_data_in_user_scope:function(){var t={};for(var e in this.commitHistory.forEach((function(e,r,a){void 0===t[e.author]?t[e.author]=1:t[e.author]+=1})),t)this.perUser.push({key:e,value:t[e]});this.perUser.sort((function(t,e){return e.value-t.value}))},draw_pie_chart:function(){console.log("echarts="),console.log(o);var t=i.exports.init(this.$refs.user_specific_pie_chart);window.addEventListener("resize",(function(){t.resize()})),t.setOption({title:{text:"",left:"center"},legend:{orient:"vertical",left:10,data:this.perUser.label},tooltip:{trigger:"item",formatter:function(t){return t.data.key+" : "+t.data.value+"次"}},series:[{name:"提交次数",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,labelLine:{show:!1},data:this.perUser}]})}}},(function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("h1",[t._v("分支详情 - "+t._s(t.branchName))]),e("v-row",[e("v-col",{staticClass:"px-3",attrs:{cols:"3"}},[e("h2",[t._v("提交记录")]),e("v-list",{staticClass:"overflow-y-auto",attrs:{"max-height":"1200px"}},t._l(t.commitHistory,(function(r){return e("v-list-item",{key:r.id},[e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(r.commitMessage))]),e("v-list-item-subtitle",[t._v(t._s(new Date(r.commitTime).toLocaleString())+" - "+t._s(r.commithash.slice(0,6))+" - "+t._s(r.author))])],1)],1)})),1)],1),e("v-divider",{attrs:{vertical:""}}),e("v-col",{attrs:{cols:"9"}},[e("v-container",{attrs:{fluid:""}},[e("v-row",{attrs:{dense:""}},t._l([t.daily,t.monthly,t.yearly],(function(r,a){return e("v-col",{key:a,attrs:{cols:r.col}},[e("v-card",{staticClass:"text-center align-center",attrs:{color:r.color}},[e("v-sparkline",{attrs:{labels:r.label,value:r.data,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),e("v-card-title",[t._v("从 "+t._s(r.label[0])+" 到 "+t._s(r.label[r.label.length-1])+" 的提交")])],1)],1)})),1),e("br"),e("v-divider"),e("br"),e("v-row",{attrs:{dense:""}},[e("v-col",{attrs:{cols:"12"}},[e("v-card",[e("v-container",{attrs:{fluid:""}},[e("v-row",[e("v-col",{attrs:{cols:"8"}},[e("div",{ref:"user_specific_pie_chart",staticClass:"lime",staticStyle:{height:"20em"}})]),e("v-col",{attrs:{cols:"4"}},[e("v-list",{staticClass:"overflow-y-auto",attrs:{dense:"","max-height":"20em"}},t._l(t.perUser,(function(r){return e("v-list-item",{key:r.key},[e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(r.key))]),e("v-list-item-subtitle",[t._v(t._s(r.value)+" 次提交")])],1)],1)})),1)],1)],1)],1),e("v-card-title",[t._v("用户提交数量")])],1)],1)],1)],1)],1)],1)],1)}),[],!1,null,"bb045044",null,null).exports)}}}));
