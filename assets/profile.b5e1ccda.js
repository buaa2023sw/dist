import{n as i,v as r}from"./index.36589bff.js";import{u as o}from"./util.06b4a6d2.js";const l={name:"profile",inject:{user:{default:null}},data(){return{showedUserName:"",userInfo:{username:"",email:"",avatar:""},showChangePassword:!1,oldPassword:"",newPassword:"",confirmNewPassword:""}},created(){this.showProfile()},methods:{showProfile(){r.post("/api/showProfile",{userId:this.user.id}).then(a=>{console.log(a),a.data.errcode===1?this.$message({type:"error",message:"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25"}):(this.showedUserName=a.data.data.userName,this.userInfo.username=a.data.data.userName,this.userInfo.email=a.data.data.userEmail)}).catch(a=>{console.error(a),this.userMessages=null})},save(){const a=this.userInfo.username,e=this.userInfo.email;if(!o.trim(a)||!o.trim(e)){this.$message({type:"error",message:"\u7528\u6237\u540D\u6216\u90AE\u7BB1\u4E0D\u80FD\u4E3A\u7A7A"});return}console.log(a),console.log(e),r.post("/api/editProfile",{userId:this.user.id,userName:a,userEmail:e}).then(s=>{console.log(1111111),s.data.errcode===0?(this.$message({type:"success",message:"\u4FDD\u5B58\u6210\u529F"}),this.showProfile()):s.data.errcode===1?this.$message({type:"error",message:"\u4FDD\u5B58\u5931\u8D25"}):s.data.errcode===2?this.$message({type:"error",message:"\u8BE5\u90AE\u7BB1\u5DF2\u88AB\u4F7F\u7528"}):s.data.errcode===3&&this.$message({type:"error",message:"\u8BE5\u7528\u6237\u540D\u5DF2\u88AB\u4F7F\u7528"})}).catch(s=>{console.log(s)})},async changePassword(){if(this.oldPassword===""){this.$message({type:"error",message:"\u539F\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"});return}if(this.newPassword===""){this.$message({type:"error",message:"\u65B0\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"});return}if(this.newPassword!==this.confirmNewPassword){this.$message({type:"error",message:"\u8BF7\u4FDD\u8BC1\u65B0\u5BC6\u7801\u548C\u786E\u8BA4\u65B0\u5BC6\u7801\u5185\u5BB9\u4E00\u81F4"});return}r.post("/api/user/information/password",{userId:this.user.id,oldPassword:this.oldPassword,newPassword:this.newPassword}).then(a=>{a.data.errcode===1?this.$message({type:"error",message:"\u8BF7\u91CD\u65B0\u786E\u8BA4\u539F\u5BC6\u7801"}):(this.showChangePassword=!1,this.oldPassword="",this.newPassword="",this.confirmNewPassword="",this.$message({type:"success",message:"\u5BC6\u7801\u4FEE\u6539\u6210\u529F"}))}).catch(a=>{console.log(a)})},openChangePasswordDialog(){this.showChangePassword=!0},closeChangePasswordDialog(){this.showChangePassword=!1}}};var n=function(){var e=this,s=e._self._c;return s("v-container",{attrs:{fluid:"","fill-height":""}},[s("v-row",{attrs:{align:"center",justify:"center"}},[s("v-col",{attrs:{cols:"12"}},[s("v-card",{staticClass:"mx-auto",attrs:{width:"800",height:"300",padding:"16"}},[s("v-card-title",{staticClass:"headline font-weight text-left"},[e._v("\u67E5\u770B\u4E2A\u4EBA\u4FE1\u606F")]),s("v-divider"),s("v-row",{attrs:{align:"center"}},[s("v-col",{staticClass:"text-center",attrs:{cols:"3"}},[s("v-avatar",{attrs:{color:"indigo",size:"100"}},[s("span",{staticClass:"white--text text-h5"},[e._v(" "+e._s(e.showedUserName)+" ")])]),s("div",[e._v(" "+e._s(e.showedUserName)+" ")])],1),s("v-col",{attrs:{cols:"8"}},[s("v-text-field",{attrs:{label:"\u7528\u6237\u540D",outlined:"",dense:""},model:{value:e.userInfo.username,callback:function(t){e.$set(e.userInfo,"username",t)},expression:"userInfo.username"}}),s("v-text-field",{attrs:{label:"\u90AE\u7BB1",outlined:"",dense:""},model:{value:e.userInfo.email,callback:function(t){e.$set(e.userInfo,"email",t)},expression:"userInfo.email"}})],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"red",text:""},on:{click:e.openChangePasswordDialog}},[e._v("\u4FEE\u6539\u5BC6\u7801")]),s("v-btn",{attrs:{color:"primary",text:""},on:{click:e.save}},[e._v("\u4FDD\u5B58")])],1)],1)],1)],1),s("v-dialog",{attrs:{width:"500"},model:{value:e.showChangePassword,callback:function(t){e.showChangePassword=t},expression:"showChangePassword"}},[[s("v-container",{staticClass:"pa-0"},[s("v-card",[s("v-card-title",{staticClass:"headline font-weight text-left"},[e._v("\u4FEE\u6539\u5BC6\u7801")]),s("v-divider"),s("v-card-text",[s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u539F\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{outlined:"",dense:"",type:"password"},model:{value:e.oldPassword,callback:function(t){e.oldPassword=t},expression:"oldPassword"}})],1)])],1),s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u65B0\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{outlined:"",dense:"",type:"password"},model:{value:e.newPassword,callback:function(t){e.newPassword=t},expression:"newPassword"}})],1)])],1),s("v-row",[s("v-col",{attrs:{cols:"4"}},[s("div",{staticClass:"input-label"},[e._v("\u786E\u8BA4\u65B0\u5BC6\u7801\uFF1A")])]),s("v-col",{attrs:{cols:"8"}},[s("div",{staticClass:"input-field"},[s("v-text-field",{attrs:{outlined:"",dense:"",type:"password"},model:{value:e.confirmNewPassword,callback:function(t){e.confirmNewPassword=t},expression:"confirmNewPassword"}})],1)])],1)],1),s("v-card-actions",[s("v-spacer"),s("v-btn",{attrs:{color:"red",text:""},on:{click:e.closeChangePasswordDialog}},[e._v("\u53D6\u6D88")]),s("v-btn",{attrs:{color:"blue",text:""},on:{click:e.changePassword}},[e._v("\u786E\u8BA4\u4FEE\u6539")])],1)],1)],1)]],2)],1)},d=[],c=i(l,n,d,!1,null,"14d830c6",null,null);const u=c.exports;export{u as default};
