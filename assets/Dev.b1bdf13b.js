import{n as i,a as n,d as o}from"./index.84c01e78.js";const u={name:"bindGithubRepo",data(){return{gh_username:"",gh_reponame:"",git_url:"",seperate:!0,bindingInProgress:!1}},inject:{user:{default:null},proj:{default:null}},methods:{bindSplit(){this.bindingInProgress=!0,n.post("/api/userBindRepo",{userId:this.user.id,projectId:this.proj.id,repoRemotePath:this.gh_username+"/"+this.gh_reponame}).then(a=>{this.bindingInProgress=!1}).catch(a=>{alert("\u54E6\u4E0D\uFF0C\u597D\u50CF\u7ED1\u5B9A\u5931\u8D25\u4E86\uFF01"),this.bindingInProgress=!1})},bindWhole(){this.bindingInProgress=!0,n.post("/api/userBindRepo",{userId:this.user.id,projectId:this.proj.id,repoRemotePath:this.git_url.replace(/https:\/\/github.com\//,"")}).then(a=>{this.bindingInProgress=!1}).catch(a=>{alert("\u54E6\u4E0D\uFF0C\u597D\u50CF\u7ED1\u5B9A\u5931\u8D25\u4E86\uFF01"),this.bindingInProgress=!1})}},watch:{}};var _=function(){var e=this,t=e._self._c;return e.seperate?t("v-form",[t("v-row",[t("v-col",{attrs:{cols:"5"}},[t("v-text-field",{attrs:{label:"GitHub Username"},model:{value:e.gh_username,callback:function(s){e.gh_username=s},expression:"gh_username"}})],1),t("v-col",{staticClass:"text-center my-3",attrs:{cols:"1"}},[t("v-btn",{attrs:{fab:""},on:{click:function(s){e.seperate=!e.seperate}}},[e._v("/")])],1),t("v-col",{attrs:{cols:"6"}},[t("v-text-field",{attrs:{label:"GitHub Reponame"},model:{value:e.gh_reponame,callback:function(s){e.gh_reponame=s},expression:"gh_reponame"}})],1)],1),t("v-btn",{attrs:{disabled:e.bindingInProgress||e.gh_reponame===""||e.gh_username===""},on:{click:function(s){return e.bindSplit()}}},[e._v(" \u7ED1\u5B9A "+e._s(e.gh_username===""?"?":e.gh_username)+" / "+e._s(e.gh_reponame===""?"?":e.gh_reponame)+" \u5230\u201C"+e._s(e.proj.name)+"\u201D ")])],1):t("v-form",[t("v-row",[t("v-col",{staticClass:"text-center my-3",attrs:{cols:"3"}},[t("v-btn",{attrs:{block:""},on:{click:function(s){e.seperate=!e.seperate}}},[e._v("https://github.com/")])],1),t("v-col",{attrs:{cols:"9"}},[t("v-text-field",{attrs:{label:"github url"},model:{value:e.git_url,callback:function(s){e.git_url=s},expression:"git_url"}})],1)],1),t("v-btn",{attrs:{disabled:e.bindingInProgress||e.git_url===""},on:{click:function(s){return e.bindWhole()}}},[e._v(" \u7ED1\u5B9A "+e._s(e.git_url===""?"github.com/?/?":e.git_url.replace(/https:\/\/github.com\//,""))+" \u5230\u201C"+e._s(e.proj.name)+"\u201D ")])],1)},p=[],v=i(u,_,p,!1,null,null,null,null);const h=v.exports;const m={name:"bindedGithubRepos",inject:{proj:{default:null},bindRepos:{default:null},bindReposBusy:{default:null}},data(){return{}},methods:{}};var f=function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("\u5DF2\u7ED1\u5B9A\u7684\u4EE3\u7801\u5B58\u50A8\u5E93")]),e.bindReposBusy?t("p",[e._v("\u6B63\u5728\u52A0\u8F7D\u9879\u76EE\u201C"+e._s(e.proj.name)+"\u201D\u5DF2\u7ED1\u5B9A\u7684\u4EE3\u7801\u5B58\u50A8\u5E93\u5217\u8868...")]):t("p",[e._v("\u9879\u76EE\u201C"+e._s(e.proj.name)+"\u201D\u5DF2\u7ED1\u5B9A "+e._s(e.bindRepos.length)+" \u4E2A\u4EE3\u7801\u5B58\u50A8\u5E93\u3002")]),t("v-divider"),t("br"),e.bindReposBusy?t("v-skeleton-loader",{attrs:{type:"list-item, list-item, list-item"}}):e.bindRepos.length>0?t("v-expansion-panels",e._l(e.bindRepos,function(s){return t("v-expansion-panel",{key:s.id},[t("v-expansion-panel-header",[e._v(" "+e._s(s.user)+" / "+e._s(s.repo)+" ")]),t("v-expansion-panel-content",[t("v-divider"),s.intro!==""?t("span",{staticClass:"description"},[e._v(e._s(s.intro))]):t("span",{staticClass:"description"},[e._v("\u5B58\u50A8\u5E93\u7684\u7B80\u4ECB\u7A7A\u7A7A\u5982\u4E5F\u5462")]),t("v-divider"),t("br"),t("v-row",[t("v-col",{staticClass:"text-center",attrs:{cols:"6"}},[t("v-btn",{attrs:{link:"",href:"https://github.com/"+s.user+"/"+s.repo,target:"_blank"}},[e._v("GitHub")])],1),t("v-col",{staticClass:"text-center",attrs:{cols:"6"}},[t("v-btn",[e._v("Unbind")])],1)],1)],1)],1)}),1):t("v-card",[t("v-card-title",[t("v-icon",[e._v("mdi-github")]),t("span",{staticClass:"headline ml-3"},[e._v("\u8FD8\u6CA1\u6709\u7ED1\u5B9A\u4EE3\u7801\u5B58\u50A8\u5E93")])],1),t("v-divider"),t("v-card-subtitle",[t("span",{staticClass:"subtitle-1 ml-4"},[e._v("\u5514\uFF0C\u5FEB\u53BB\u7ED1\u5B9A\u4E00\u4E2A\u4EE3\u7801\u5B58\u50A8\u5E93\u5F00\u59CB\u8BB0\u5F55\u4F60\u7684\u5DE5\u4F5C\u5427\uFF01")])])],1)],1)},b=[],g=i(m,f,b,!1,null,"b9f79a0c",null,null);const y=g.exports;const R={name:"commit_view",methods:{updateCommitHistory(){this.commitHistoryBusy=!0,n.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.proj.id,repoId:this.selectedRepo.id,branchName:this.selectedBranch.name}).then(a=>{if(a.data.errcode===0){let e=new Date,t={};for(let r=0;r<10;r++){let l=e.getMonth()+1+"."+e.getDate();t[l]=0,e.setDate(e.getDate()-1)}let s=a.data.data.map((r,l,Q)=>{let d=new Date(r.commitTime),c=d.getMonth()+1+"."+d.getDate();return c in t&&(t[c]+=1),{id:l,committer:r.author,committerEmail:r.authorEmail,hash:r.commithash,message:r.commitMessage,time:r.commitTime}});this.commitHistory=s,this.commitHistoryBusy=!1,this.statsPerDay={label:Object.keys(t).reverse(),value:Object.values(t).reverse()}}else console.log(a),alert("/api/develop/getCommitHistory error with not 0 err code ("+a.data.errcode+") "+a.data.message),this.commitHistoryBusy=!1}).catch(a=>{alert("/api/develop/getBindRepos error"+a),this.commitHistoryBusy=!1})}},data(){return{commitHistoryBusy:!0,commitHistory:[{id:1,committer:"TrickEye",message:"commitMessage, hahaha",hash:"114514",time:"2023/4/2"}],statsPerDay:{}}},watch:{selectedBranch(){this.updateCommitHistory()}},created(){this.updateCommitHistory()},inject:{user:{default:null},proj:{default:null},selectedRepo:{default:null},selectedBranch:{default:null}}};var B=function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("\u5206\u652F\u201C"+e._s(e.selectedBranch.name)+"\u201D\u4E0A\u7684\u63D0\u4EA4\u8BB0\u5F55")]),e.commitHistoryBusy?t("p",[e._v("\u6B63\u5728\u4E0E\u670D\u52A1\u5668\u540C\u6B65\u5206\u652F"+e._s(e.selectedBranch.name)+"\u4E0A\u7684\u6700\u65B0\u63D0\u4EA4\u8BB0\u5F55...")]):t("p",[e._v("\u5206\u652F\u201C"+e._s(e.selectedBranch.name)+"\u201D\u4E2D\u6709 "+e._s(e.commitHistory.length)+" \u6761\u63D0\u4EA4\u8BB0\u5F55\u3002\u6700\u65B0\u7684\u63D0\u4EA4\u8BB0\u5F55\uFF1A")]),e.commitHistoryBusy?t("v-skeleton-loader",{staticClass:"mx-auto",attrs:{type:"table"}}):t("div",[t("v-simple-table",{attrs:{dense:""}},[t("thead",[t("tr",[t("th",{staticClass:"committer"},[e._v("committer")]),t("th",{staticClass:"message"},[e._v("message")]),t("th",{staticClass:"hash"},[e._v("hash")]),t("th",{staticClass:"time"},[e._v("time")])])]),t("tbody",e._l(e.commitHistory.slice(0,5),function(s){return t("tr",{key:s.id},[t("td",[e._v(e._s(s.committer))]),t("td",[e._v(e._s(s.message))]),t("td",[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function({on:r,attrs:l}){return[t("span",e._g(e._b({},"span",l,!1),r),[e._v(e._s(s.hash.slice(0,6)))])]}}],null,!0)},[t("span",[e._v(e._s(s.hash))])])],1),t("td",[e._v(e._s(new Date(s.time).toLocaleString()))])])}),0)]),t("br"),t("v-divider"),t("br"),t("span",[e._v("\u8FC7\u53BB10\u5929\u7684\u63D0\u4EA4\u8BB0\u5F55\u6570\u91CF")]),t("v-sparkline",{attrs:{labels:e.statsPerDay.label,value:e.statsPerDay.value,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),t("br"),e._v(" "),t("v-divider"),e._v(" "),t("br"),t("v-row",[t("v-col",{staticClass:"text-center",attrs:{cols:"6"}},[t("v-btn",[t("v-icon",[e._v("mdi-github")]),e._v("\u5728GitHub\u67E5\u770B")],1)],1),t("v-col",{staticClass:"text-center",attrs:{cols:"6"}},[t("v-btn",{attrs:{link:"",to:e.selectedRepo.id+"/"+e.selectedBranch.name+"/"}},[t("v-icon",[e._v("mdi-send")]),e._v("\u6D4F\u89C8\u8BE6\u60C5")],1)],1)],1)],1)],1)},x=[],I=i(R,B,x,!1,null,"fa40d857",null,null);const w=I.exports;const k={name:"branchView",components:{commit_view:w},methods:{updateBranches(){this.branchBusy=!0,n.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.selectedRepo.id,projectId:this.proj.id}).then(a=>{if(a.data.errcode===0){console.log(a),console.log("success");let e=a.data.data.map((t,s,r)=>({id:s,name:t.branchName,lastCommit:{sha:t.lastCommit.sha,authorName:t.lastCommit.authorName,authorEmail:t.lastCommit.authorEmail,commitDate:t.lastCommit.commitDate,commitMessage:t.lastCommit.commitMessage}}));console.log("branches="),console.log(e),this.branches=e,this.branchBusy=!1}else console.log(a),alert("/api/develop/getRepoBranches error with not 0 err code ("+a.data.errcode+") "+a.data.message),this.branchBusy=!1}).catch(a=>{alert("/api/develop/getBindRepos error"+a),this.branchBusy=!1})}},data(){return{selectedBranchIndex:0,branches:[{id:0,name:"master",lastCommit:{}}],branchBusy:!0}},inject:{user:{default:null},proj:{default:null},selectedRepo:{default:null}},provide(){return{selectedBranch:o(()=>this.branches[this.selectedBranchIndex])}},created(){this.updateBranches()}};var j=function(){var e=this,t=e._self._c;return t("div",[t("v-row",[t("v-col",{attrs:{cols:"3"}},[t("h2",[e._v("\u5206\u652F")]),e.branchBusy?t("div",[t("v-card-title",[t("v-progress-circular",{attrs:{indeterminate:""}}),e._v("\u6B63\u5728\u4E0E\u670D\u52A1\u5668\u540C\u6B65\u5206\u652F")],1)],1):e._e(),e.branchBusy?t("v-skeleton-loader",{attrs:{type:"list-item-three-line"}}):t("v-list",[t("v-list-item-group",{attrs:{mandatory:""},model:{value:e.selectedBranchIndex,callback:function(s){e.selectedBranchIndex=s},expression:"selectedBranchIndex"}},e._l(e.branches,function(s){return t("v-list-item",{key:s.id},[e._v(" "+e._s(s.name)+" ")])}),1)],1)],1),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"9"}},[e.branchBusy?t("v-skeleton-loader",{attrs:{type:"text@3, table"}}):t("commit_view")],1)],1)],1)},C=[],$=i(k,j,C,!1,null,"af4b1b82",null,null);const P=$.exports;const H={name:"issue_view",data(){return{issues:[{id:1,issuer:"TrickEye",title:"issue title1",isOpen:!0},{id:2,issuer:"TrickEye",title:"issue title2",isOpen:!1}],filteredIssues:o(()=>this.statusFilter===1?this.issues:this.issues.filter((a,e,t)=>a.isOpen===(this.statusFilter===0))),issuesBusy:!0,statusFilter:0,statuses:["Open","All","Closed"]}},inject:{user:{default:null},proj:{default:null},selectedRepo:{default:null}},methods:{updateIssue(){this.issuesBusy=!0,n.post("/api/develop/getIssueList",{userId:this.user.id,repoId:this.selectedRepo.id,projectId:this.proj.id}).then(a=>{if(a.data.errcode===0){console.log(a),console.log("get issue success: ");let e=a.data.data.map((t,s,r)=>({id:t.issueId,issuer:t.issuer,title:t.issueTitle,time:t.issueTime,isOpen:t.isOpen,ghLink:t.ghLink}));console.log(e),this.issues=e,this.issuesBusy=!1}else console.log(a),alert("/api/develop/getIssueList error with not 0 err code ("+a.data.errcode+") "+a.data.message),this.issuesBusy=!1}).catch(a=>{alert("/api/develop/getIssueList error"+a),this.issuesBusy=!1})},issueFilter(){return this.issues.filter(a=>!(a.isOpen&&this.statusFilter===2||!a.isOpen&&this.statusFilter===0))}},created(){this.updateIssue()}};var F=function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("\u4E8B\u52A1")]),this.issuesBusy?t("v-skeleton-loader",{attrs:{type:"button, table"}}):this.issues.length!==0?t("v-row",[t("v-col",[t("v-btn",{staticStyle:{"margin-left":"10px","margin-right":"20px"},attrs:{rounded:""},on:{click:function(s){e.statusFilter=(e.statusFilter+1)%3,e.filteredIssues=e.issueFilter()}}},[e._v(" "+e._s(e.statuses[e.statusFilter])+" ")])],1)],1):t("v-row",[t("v-col",[t("p",[e._v("\u4F3C\u4E4E\u4E8B\u52A1\u7A7A\u7A7A\u5982\u4E5F\uFF1F\u73B0\u5728\u5C31\u53BBGitHub\u4E0A\u53D1\u4E00\u4E2A\u5427\uFF01")])])],1),t("v-simple-table",{attrs:{dense:""}},[t("tbody",e._l(e.filteredIssues,function(s){return t("tr",{key:s.id},[t("td",[e._v("#"+e._s(s.id)+" ("+e._s(s.isOpen?"\u5F00\u542F":"\u5DF2\u5173\u95ED")+")")]),t("td",[e._v(e._s(s.issuer))]),t("td",[e._v(e._s(s.title))])])}),0)])],1)},D=[],O=i(H,F,D,!1,null,"bc83c719",null,null);const G=O.exports;const T={name:"pr_view",data(){return{prs:[{id:1,author:"TrickEye",title:"PR title1",date:"20230403",fromBranchId:2,toBranchId:1,isOpen:!0},{id:2,author:"TrickEyeee",title:"PR title2",date:"20230402",fromBranchId:3,toBranchId:1,isOpen:!0}],prsBusy:!0}},methods:{updatePR(){this.prsBusy=!0,n.post("/api/develop/getPrList",{userId:this.user.id,projectId:this.proj.id,repoId:this.selectedRepo.id}).then(a=>{if(a.data.errcode===0){console.log(a.data.data);let e=a.data.data.map((t,s,r)=>({id:t.prId,author:t.prIssuer,title:t.prTitle,date:t.prTime,isOpen:t.isOpen,ghLink:t.ghLink,fromBranchName:t.fromBranchName,toBranchName:t.toBranchName}));this.prs=e,this.prsBusy=!1}else console.log("get pr failure with not 0 err code + {"+a.data.errcode+")"+a.data.message),this.prsBusy=!1}).catch(a=>{console.log("get pr failure with err: "+a),this.prsBusy=!1})}},inject:{user:{default:null},proj:{default:null},selectedRepo:{default:null}},created(){this.updatePR()}};var N=function(){var e=this,t=e._self._c;return t("div",[t("h2",[e._v("\u548C\u5E76\u8BF7\u6C42")]),this.prsBusy?t("v-skeleton-loader",{attrs:{type:"button, table"}}):this.prs.length>0?t("v-row",[t("v-col",[t("v-simple-table",{attrs:{dense:""}},[t("tbody",e._l(e.prs,function(s){return t("tr",{key:s.id},[t("td",[e._v("#"+e._s(s.id)+" ("+e._s(s.isOpen?"\u5F00\u542F":"\u5DF2\u5173\u95ED")+")")]),t("td",[e._v(e._s(s.author))]),t("td",[e._v(e._s(s.title))]),t("td",[e._v("\u4ECE\u5206\u652F\u201C"+e._s(s.fromBranchName)+"\u201D\u5408\u5E76\u5230\u201C"+e._s(s.toBranchName)+"\u201D")])])}),0)])],1)],1):t("v-row",[t("v-col",[t("p",[e._v("\u548C\u5E76\u8BF7\u6C42\u4F3C\u4E4E\u7A7A\u7A7A\u5982\u4E5F\uFF1F\u73B0\u5728\u5C31\u53BBGitHub\u4E0A\u53D1\u4E00\u4E2A\u5427\uFF01")])])],1)],1)},E=[],L=i(T,N,E,!1,null,"bf3c32be",null,null);const M=L.exports,V={name:"repoView",components:{branchView:P,issue_view:G,pr_view:M},data(){return{selectedRepo:0}},inject:{proj:{default:null},bindRepos:{default:null},bindReposBusy:{default:null}},provide(){return{selectedRepo:o(()=>this.bindRepos[this.selectedRepo])}}};var S=function(){var e=this,t=e._self._c;return t("v-col",{staticClass:"px-1",attrs:{cols:"12"}},[e.bindReposBusy?t("h2",[e._v("\u4EE3\u7801\u5B58\u50A8\u5E93")]):t("h2",[e._v("\u4EE3\u7801\u5B58\u50A8\u5E93 - "+e._s(e.bindRepos[e.selectedRepo].user)+" / "+e._s(e.bindRepos[e.selectedRepo].repo))]),e.bindReposBusy?t("v-skeleton-loader",{attrs:{type:"card"}}):t("div",[t("v-tabs",{model:{value:e.selectedRepo,callback:function(s){e.selectedRepo=s},expression:"selectedRepo"}},e._l(e.bindRepos,function(s){return t("v-tab",{key:s.id},[e._v(e._s(s.repo))])}),1),t("v-tabs-items",{model:{value:e.selectedRepo,callback:function(s){e.selectedRepo=s},expression:"selectedRepo"}},e._l(e.bindRepos,function(s){return t("v-tab-item",{key:s.id},[e.bindRepos[e.selectedRepo].intro!==""?t("p",[e._v("\u4EE3\u7801\u5B58\u50A8\u5E93\u4ECB\u7ECD\uFF1A"+e._s(e.bindRepos[e.selectedRepo].intro))]):t("p",[e._v("\u8FD9\u4E2A\u4EE3\u7801\u5B58\u50A8\u5E93\u6CA1\u6709\u4ECB\u7ECD\u54E6")]),t("v-row",[t("v-col",{staticClass:"ma-1"},[t("v-card",{staticClass:"pa-2",attrs:{raised:""}},[t("branchView")],1)],1)],1),t("v-row",[t("v-col",{staticClass:"ma-1"},[t("v-card",{staticClass:"pa-2",attrs:{raised:""}},[t("issue_view")],1)],1)],1),t("v-row",[t("v-col",{staticClass:"ma-1"},[t("v-card",{staticClass:"pa-2",attrs:{raised:""}},[t("pr_view")],1)],1)],1)],1)}),1)],1)],1)},U=[],W=i(V,S,U,!1,null,null,null,null);const z=W.exports;const A={name:"Dev",components:{bindGithubRepo:h,bindedGithubRepos:y,repoView:z},data(){return{bindRepos:[],bindReposBusy:!0}},created(){this.updateBindRepos()},inject:{user:{default:null},selectedProj:{default:null}},provide(){return{proj:o(()=>this.selectedProj),bindRepos:o(()=>this.bindRepos),bindReposBusy:o(()=>this.bindReposBusy)}},methods:{modifyUser(){alert("not implemented!")},updateBindRepos(){this.bindReposBusy=!0,n.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.selectedProj.id}).then(a=>{a.data.errcode===0?(this.bindRepos=a.data.data.map((e,t,s)=>{let r=e.repoRemotePath;return r=r.split("/"),{id:e.repoId,user:r[0],repo:r[1],intro:e.repoIntroduction}}),this.bindReposBusy=!1):(console.log(a),this.bindReposBusy=!1,alert("/api/develop/getBindRepos error with not 0 err code ("+a.data.errcode+") "+a.data.message))}).catch(a=>{alert("/api/develop/getBindRepos error"+a),this.bindReposBusy=!1})}}};var q=function(){var e=this,t=e._self._c;return t("v-app",[t("v-container",[t("v-row",[t("h1",[e._v("\u5F00\u53D1 - "+e._s(e.selectedProj.name))])]),t("v-row",[t("v-col",{attrs:{cols:"6"}},[t("bindedGithubRepos")],1),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"6"}},[t("h2",[e._v("\u6216\u8005\u7ED1\u5B9A\u4E00\u4E2A\u65B0\u7684\u4EE3\u7801\u5B58\u50A8\u5E93")]),t("bindGithubRepo")],1)],1),t("v-row",[t("repoView")],1)],1)],1)},J=[],K=i(A,q,J,!1,null,"e9920f9a",null,null);const Y=K.exports;export{Y as default};
