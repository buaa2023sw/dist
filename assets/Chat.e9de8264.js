import{n as r}from"./index.8a781918.js";const l={name:"Chat",data(){return{selectedRoom:0,messageInput:"",chatRooms:[]}},created(){this.updateChatRooms()},inject:{user:{default:null}},methods:{updateChatRooms(){console.log("updating chat rooms...");let o={};this.chatRooms.forEach((t,e)=>{t.ws!==null&&(o[t.id]=t.ws)}),this.chatRooms=[{id:1,title:"room1",history:[]}],this.chatRooms.forEach((t,e)=>{o[t.id]!==void 0?(t.ws=o[t.id],o[t.id]=void 0):t.ws=this.initWS(t.id)});for(const[t,e]of Object.entries(o))e.close()},initWS(o){console.log("initWS: connecting to ws://104.208.78.33:8000/ws/chat/"+this.user.id.toString()+"/"+o.toString());const t=new WebSocket("ws://104.208.78.33:8000/ws/chat/"+this.user.id.toString()+"/"+o.toString()),e=n=>{t.send(JSON.stringify({sender:this.user.id,type:1,message:this.user.name+" has joined the group chat!"}))};t.onopen=e;const s=(n,i,c,a)=>{this.chatRooms[this.selectedRoom].history.push({from:n,type:"group",content:c,time:a})};return t.onmessage=function(n){console.log("Message from server ",n.data);var i=JSON.parse(n.data);s(i.senderName,i.senderId,i.content,i.time)},t.onerror=function(n){console.error("WebSocket error observed:",n)},t.onclose=function(n){console.log("Socket is closed.",n.reason)},t},sendMsg(){console.log("will send: "+this.messageInput),this.chatRooms[this.selectedRoom].ws.send(JSON.stringify({sender:this.user.id,type:1,message:this.messageInput})),this.messageInput=""}}};var d=function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("h1",[t._v("\u804A\u5929\u5BA4")]),e("v-row",[e("v-col",{attrs:{cols:"4"}},[e("p",[t._v("selected room: "+t._s(t.selectedRoom))]),e("v-list",[e("v-list-item-group",{attrs:{mandatory:""},model:{value:t.selectedRoom,callback:function(s){t.selectedRoom=s},expression:"selectedRoom"}},t._l(t.chatRooms,function(s){return e("v-list-item",{key:s.id},[e("v-list-item-title",[t._v(t._s(s.title))]),e("v-list-item-subtitle",[t._v(t._s(s.history.length===0?"\u8FD8\u6CA1\u6709\u6D88\u606F\u54E6":s.history[s.history.length-1].content))])],1)}),1)],1)],1),e("v-col",{attrs:{cols:"8"}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card",[e("v-card-title",{staticClass:"v-app-bar-title"},[t._v(t._s(t.chatRooms[t.selectedRoom].title))]),e("v-card-subtitle",[this.chatRooms[this.selectedRoom].ws.readyState===1?e("v-icon",{staticClass:"green--text"},[t._v("mdi-circle")]):e("v-icon",{staticClass:"yellow--text"},[t._v("mdi-circle")]),t._v(" ws://104.208.78.33:8000/ws/chat/11/1 ")],1)],1)],1)],1),e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card",[e("v-card-text",[e("v-list",{staticClass:"overflow-auto scroll-y",attrs:{"min-height":"600","max-height":"600"}},[e("v-list-item-group",t._l(t.chatRooms[t.selectedRoom].history,function(s){return e("v-list-item",{key:s.id},[e("v-list-item-title",[t._v(t._s(s.from)+" : "+t._s(s.content))])],1)}),1)],1)],1)],1)],1)],1),e("v-row",[e("v-col",{attrs:{cols:"10"}},[e("v-text-field",{attrs:{label:"\u8F93\u5165\u6D88\u606F"},model:{value:t.messageInput,callback:function(s){t.messageInput=s},expression:"messageInput"}})],1),e("v-col",{attrs:{cols:"2"}},[e("v-btn",{attrs:{block:""},on:{click:t.sendMsg}},[t._v("SEND")])],1)],1)],1)],1)],1)},h=[],m=r(l,d,h,!1,null,"e00d9120",null,null);const u=m.exports;export{u as default};
