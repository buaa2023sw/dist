import{n as m,j as n,k as h}from"./index.f443fa84.js";import{a as p,e as u}from"./echarts.20affc20.js";const v={name:"FileView",data(){return{tree:[],files:{html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-code-json",md:"mdi-language-markdown",pdf:"mdi-file-pdf",png:"mdi-file-image",txt:"mdi-file-document-outline",xls:"mdi-file-excel"},items:[{name:"README.md",file:"md"},{name:"src",children:[{name:"file1.txt",file:"txt"}]}],fileContent:"Select a file to view its content."}},inject:{user:{default:null},proj:{default:null},repo:{default:null},branchName:{default:null}},methods:{getFileExt(a,e){if(a.children===void 0)a.file="unknown",a.path=e+"/"+a.name,a.name.indexOf(".")!==-1&&(a.file=a.name.split(".").pop());else for(let t=0;t<a.children.length;t++)this.getFileExt(a.children[t],e+"/"+a.name)}},created(){n.post("/api/develop/getFileTree",{userId:this.user.id,projectId:this.proj.projectId,repoId:this.$route.params.repoid,branch:this.branchName}).then(a=>{if(a.data.errcode===0){console.log(a.data.data),this.items=a.data.data;for(let e=0;e<this.items.length;e++)this.getFileExt(this.items[e],"")}else alert("/api/develop/getFileTree errcode not 0: "+a.data.message)}).catch(a=>{alert("/api/develop/getFileTree error"+a),console.log(a)})},watch:{tree(){console.log("selected file change!"),this.tree[0].file!==void 0&&n.post("/api/develop/getContent",{userId:this.user.id,projectId:this.proj.projectId,repoId:this.$route.params.repoid,branch:this.branchName,path:this.tree[0].path}).then(a=>{a.data.errcode===0?(console.log(a.data.data),this.fileContent=a.data.data):alert("/api/develop/getFileContent errcode not 0: "+a.data.message)}).catch(a=>{alert("/api/develop/getFileContent error"+a),console.log(a)})}}};var f=function(){var e=this,t=e._self._c;return t("v-container",[t("v-row",[t("v-col",{attrs:{cols:"3"}},[t("v-treeview",{attrs:{items:e.items,activatable:"",active:e.tree,"item-key":"name","open-on-click":"",dense:"","return-object":""},on:{"update:active":function(i){e.tree=i}},scopedSlots:e._u([{key:"prepend",fn:function({item:i,open:l}){return[i.file?t("v-icon",[e._v(" "+e._s(e.files[i.file])+" ")]):t("v-icon",[e._v(" "+e._s(l?"mdi-folder-open":"mdi-folder")+" ")])]}}])})],1),t("v-col",{attrs:{cols:"9"}},[t("v-card",[t("v-card-text",[t("v-textarea",{attrs:{outlined:"",readonly:"",rows:"30"},model:{value:e.fileContent,callback:function(i){e.fileContent=i},expression:"fileContent"}})],1)],1)],1)],1)],1)},_=[],g=m(v,f,_,!1,null,"c502d490",null,null);const y=g.exports;const b={name:"Branch",components:{FileView:y},data(){return{projId:this.$route.params.projid,repoId:this.$route.params.repoid,branchName:this.$route.params.branchname,proj:null,repos:null,repo:null,branches:null,commitHistory:null,daily:{col:4,color:"#FFCDD2",title:"\u8FC7\u53BB\u4E09\u5341\u65E5\u5185\u7684\u63D0\u4EA4",label:[],data:[]},monthly:{col:4,color:"#B2EBF2",title:"\u8FC7\u53BB\u4E00\u5E74\u5185\u7684\u63D0\u4EA4",label:[],data:[]},yearly:{col:4,color:"#C8E6C9",title:"\u8FC7\u53BB\u5341\u5E74\u5185\u7684\u63D0\u4EA4",label:[],data:[]},perUser:[]}},provide(){return{repo:h(()=>this.repo),branchName:h(()=>this.branchName)}},created(){this.proj=this.user.projects.reduce((a,e)=>e.projectId==this.projId?e:a,null),this.proj===null&&alert("proj not found"),n.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.projId}).then(a=>{a.data.errcode===0?(this.repos=a.data.data.map((e,t,i)=>{let l=e.repoRemotePath.split("/");return{id:e.repoId,user:l[0],repo:l[1],intro:e.repoIntroduction}}),this.repo=this.repos.reduce((e,t)=>t.id==this.repoId?t:e,null),this.repo===null&&alert("repo not found")):alert("/api/develop/getBindRepos error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getBindRepos error"+a)}),n.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.repoId,projectId:this.projId}).then(a=>{a.data.errcode===0?(this.branches=a.data.data.map((t,i,l)=>t.branchName),this.branches.reduce((t,i)=>i==this.branchName?i:t,null)===null&&alert("branch "+this.branchName+" not found in branches "+this.branches)):alert("/api/develop/getBranches error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getBranches error"+a)}),n.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.projId,repoId:this.repoId,branchName:this.branchName}).then(a=>{a.data.errcode===0?(this.commitHistory=a.data.data.map((e,t,i)=>({id:t,author:e.author,authorEmail:e.authorEmail,commithash:e.commithash,commitMessage:e.commitMessage,commitTime:e.commitTime})),this.prep_data_in_time_scope(),this.prep_data_in_user_scope(),this.draw_pie_chart()):alert("/api/develop/getCommitHistory error with not 0 err code ("+a.data.errcode+") "+a.data.message)}).catch(a=>{alert("/api/develop/getCommitHistory error"+a)})},inject:{user:{default:null}},methods:{prep_data_in_time_scope(){let a=this.commitHistory[this.commitHistory.length-1],e=new Date(a.commitTime);e.setDate(e.getDate()-1);let t={},i=new Date;for(;i>=e;){let r=e.toLocaleDateString();t[r]=0,e.setDate(e.getDate()+1)}this.commitHistory.forEach((r,d,c)=>{let o=new Date(r.commitTime).toLocaleDateString();t[o]===void 0?t[o]=1:t[o]+=1}),this.daily.label=Object.keys(t);for(let r=1;r<this.daily.label.length-1;r++)this.daily.label[r]="";this.daily.data=Object.values(t);let l={};for(e=new Date(a.commitTime),e.setMonth(e.getMonth()-1);i>=e;){let r=e.getFullYear()+"-"+(e.getMonth()+1);l[r]=0,e.setMonth(e.getMonth()+1)}this.commitHistory.forEach((r,d,c)=>{let o=new Date(r.commitTime).getFullYear()+"-"+(new Date(r.commitTime).getMonth()+1);l[o]===void 0?l[o]=1:l[o]+=1}),this.monthly.label=Object.keys(l),this.monthly.data=Object.values(l);let s={};for(e=new Date(a.commitTime),e.setFullYear(e.getFullYear()-1);i>=e;){let r=e.getFullYear();s[r]=0,e.setFullYear(e.getFullYear()+1)}this.commitHistory.forEach((r,d,c)=>{let o=new Date(r.commitTime).getFullYear();s[o]===void 0?s[o]=1:s[o]+=1}),this.yearly.label=Object.keys(s),this.yearly.data=Object.values(s)},prep_data_in_user_scope(){let a={};this.commitHistory.forEach((e,t,i)=>{a[e.author]===void 0?a[e.author]=1:a[e.author]+=1});for(let e in a)this.perUser.push({key:e,value:a[e]});this.perUser.sort((e,t)=>t.value-e.value)},draw_pie_chart(){console.log("echarts="),console.log(p);let a=u.exports.init(this.$refs.user_specific_pie_chart);window.addEventListener("resize",()=>{a.resize()}),a.setOption({title:{text:"",left:"center"},legend:{orient:"vertical",left:10,data:this.perUser.label},tooltip:{trigger:"item",formatter:function(e){return e.data.key+" : "+e.data.value+"\u6B21"}},series:[{name:"\u63D0\u4EA4\u6B21\u6570",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,labelLine:{show:!1},data:this.perUser}]})}}};var w=function(){var e=this,t=e._self._c;return t("v-container",{attrs:{fluid:""}},[t("h1",[e._v("\u5206\u652F\u8BE6\u60C5 - "+e._s(e.branchName))]),t("v-row",[t("v-col",{staticClass:"px-3",attrs:{cols:"3"}},[t("h2",[e._v("\u63D0\u4EA4\u8BB0\u5F55")]),t("v-list",{staticClass:"overflow-y-auto",attrs:{"max-height":"1200px"}},e._l(e.commitHistory,function(i){return t("v-list-item",{key:i.id},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(i.commitMessage))]),t("v-list-item-subtitle",[e._v(e._s(new Date(i.commitTime).toLocaleString())+" - "+e._s(i.commithash.slice(0,6))+" - "+e._s(i.author))])],1)],1)}),1)],1),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"9"}},[t("v-container",{attrs:{fluid:""}},[t("v-row",{attrs:{dense:""}},e._l([e.daily,e.monthly,e.yearly],function(i,l){return t("v-col",{key:l,attrs:{cols:i.col}},[t("v-card",{staticClass:"text-center align-center",attrs:{color:i.color}},[t("v-sparkline",{attrs:{labels:i.label,value:i.data,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),t("v-card-title",[e._v("\u4ECE "+e._s(i.label[0])+" \u5230 "+e._s(i.label[i.label.length-1])+" \u7684\u63D0\u4EA4")])],1)],1)}),1),t("br"),t("v-divider"),t("br"),t("v-row",{attrs:{dense:""}},[t("v-col",{attrs:{cols:"12"}},[t("v-card",[t("v-container",{attrs:{fluid:""}},[t("v-row",[t("v-col",{attrs:{cols:"8"}},[t("div",{ref:"user_specific_pie_chart",staticClass:"lime",staticStyle:{height:"20em"}})]),t("v-col",{attrs:{cols:"4"}},[t("v-list",{staticClass:"overflow-y-auto",attrs:{dense:"","max-height":"20em"}},e._l(e.perUser,function(i){return t("v-list-item",{key:i.key},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(i.key))]),t("v-list-item-subtitle",[e._v(e._s(i.value)+" \u6B21\u63D0\u4EA4")])],1)],1)}),1)],1)],1)],1),t("v-card-title",[e._v("\u7528\u6237\u63D0\u4EA4\u6570\u91CF")])],1)],1)],1)],1),t("v-container",{attrs:{fluid:""}},[t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-card",[t("v-card-title",[e._v("\u6587\u4EF6\u5217\u8868")]),t("v-card-text",[t("FileView")],1)],1)],1)],1)],1)],1)],1)],1)},x=[],I=m(b,w,x,!1,null,"3a452abf",null,null);const F=I.exports;export{F as default};
