System.register(["./index-legacy.c93422cc.js"],(function(t,e){"use strict";var r,a,o=document.createElement("style");return o.textContent="",document.head.appendChild(o),{setters:[function(t){r=t.n,a=t.a}],execute:function(){t("default",r({name:"Branch",data:function(){return{projId:this.$route.params.projid,repoId:this.$route.params.repoid,branchName:this.$route.params.branchname,proj:null,repos:null,repo:null,branches:null,commitHistory:null,daily:{col:4,color:"red",title:"过去三十日内的提交",label:[],data:[]},monthly:{col:4,color:"blue",title:"过去一年内的提交",label:[],data:[]},yearly:{col:4,color:"green",title:"过去十年内的提交",label:[],data:[]}}},created:function(){var t=this;this.proj=this.user.projects.reduce((function(e,r){return r.id==t.projId?r:e}),null),null===this.proj&&alert("proj not found"),a.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.projId}).then((function(e){0===e.data.errcode?(t.repos=e.data.data.map((function(t,e,r){var a=t.repoRemotePath.split("/");return{id:t.repoId,user:a[0],repo:a[1],intro:t.repoIntroduction}})),t.repo=t.repos.reduce((function(e,r){return r.id==t.repoId?r:e}),null),null===t.repo&&alert("repo not found")):alert("/api/develop/getBindRepos error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getBindRepos error"+t)})),a.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.repoId,projectId:this.projId}).then((function(e){0===e.data.errcode?(t.branches=e.data.data.map((function(t,e,r){return t.branchName})),null===t.branches.reduce((function(e,r){return r==t.branchName?r:e}),null)&&alert("branch "+t.branchName+" not found in branches "+t.branches)):alert("/api/develop/getBranches error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getBranches error"+t)})),a.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.projId,repoId:this.repoId,branchName:this.branchName}).then((function(e){0===e.data.errcode?(t.commitHistory=e.data.data.map((function(t,e,r){return{id:e,author:t.author,authorEmail:t.authorEmail,commithash:t.commithash,commitMessage:t.commitMessage,commitTime:t.commitTime}})),t.prep_data()):alert("/api/develop/getCommitHistory error with not 0 err code ("+e.data.errcode+") "+e.data.message)})).catch((function(t){alert("/api/develop/getBindRepos error"+t)}))},inject:{user:{default:null}},methods:{prep_data:function(){var t=this.commitHistory[this.commitHistory.length-1],e=new Date(t.commitTime);e.setDate(e.getDate()-1);for(var r={},a=new Date;a>=e;){var o=e.toLocaleDateString();r[o]=0,e.setDate(e.getDate()+1)}this.commitHistory.forEach((function(t,e,a){var o=new Date(t.commitTime).toLocaleDateString();void 0===r[o]?r[o]=1:r[o]+=1})),this.daily.label=Object.keys(r);for(var i=1;i<this.daily.label.length-1;i++)this.daily.label[i]="";this.daily.data=Object.values(r);var l={};for((e=new Date(t.commitTime)).setMonth(e.getMonth()-1);a>=e;){var n=e.getFullYear()+"-"+(e.getMonth()+1);l[n]=0,e.setMonth(e.getMonth()+1)}this.commitHistory.forEach((function(t,e,r){var a=new Date(t.commitTime).getFullYear()+"-"+(new Date(t.commitTime).getMonth()+1);void 0===l[a]?l[a]=1:l[a]+=1})),this.monthly.label=Object.keys(l),this.monthly.data=Object.values(l);var s={};for((e=new Date(t.commitTime)).setFullYear(e.getFullYear()-1);a>=e;){var c=e.getFullYear();s[c]=0,e.setFullYear(e.getFullYear()+1)}this.commitHistory.forEach((function(t,e,r){var a=new Date(t.commitTime).getFullYear();void 0===s[a]?s[a]=1:s[a]+=1})),this.yearly.label=Object.keys(s),this.yearly.data=Object.values(s)}}},(function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("h1",[t._v("分支详情 - "+t._s(t.branchName))]),e("v-row",[e("v-col",{staticClass:"px-3",attrs:{cols:"3"}},[e("h2",[t._v("提交记录")]),e("v-list",t._l(t.commitHistory,(function(r){return e("v-list-item",{key:r.id},[e("v-list-item-content",[e("v-list-item-title",[t._v(t._s(r.commitMessage))]),e("v-list-item-subtitle",[t._v(t._s(new Date(r.commitTime).toLocaleString())+" - "+t._s(r.commithash.slice(0,6))+" - "+t._s(r.author))])],1)],1)})),1)],1),e("v-divider",{attrs:{vertical:""}}),e("v-col",{attrs:{cols:"9"}},[e("v-container",{attrs:{fluid:""}},[e("v-row",{attrs:{dense:""}},t._l([t.daily,t.monthly,t.yearly],(function(r,a){return e("v-col",{key:a,attrs:{cols:r.col}},[e("v-card",{staticClass:"text-center align-center",attrs:{color:r.color}},[e("v-sparkline",{attrs:{labels:r.label,value:r.data,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),e("v-card-title",[t._v("从 "+t._s(r.label[0])+" 到 "+t._s(r.label[r.label.length-1])+" 的提交")])],1)],1)})),1),e("br"),e("v-divider"),e("br"),e("v-row",{attrs:{dense:""}})],1)],1)],1)],1)}),[],!1,null,"aebe20a9",null,null).exports)}}}));
