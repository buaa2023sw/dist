System.register(["./index-legacy.23e55624.js","./echarts-legacy.97a0db7c.js","./file-system-legacy.53f32f59.js"],(function(e,t){"use strict";var i,o,r,a,n,l,s,c,d,u=document.createElement("style");return u.textContent=".CodeMirror{height:calc(100vh - 300px)}.need-mono{font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,Courier,monospace}\n",document.head.appendChild(u),{setters:[function(e){i=e.n,o=e.e,r=e.t,a=e.l,n=e.o},function(e){l=e.a,s=e.e},function(e){c=e.d,d=e.c}],execute:function(){var t={name:"FileView",data:function(){return{tree:[],files:{html:"mdi-language-html5",js:"mdi-nodejs",json:"mdi-code-json",md:"mdi-language-markdown",pdf:"mdi-file-pdf",png:"mdi-file-image",txt:"mdi-file-document-outline",xls:"mdi-file-excel",vue:"mdi-vuejs"},items:[],cmEditor:null,sheet:!1,fileContent:"选择一个文件以查看其内容\n\n选择文件后，可以点击右上角”代码助手“，使用JiHub进行AI代码诊断、生成单元测试、下载文件",selectedText:"",fileTreeReady:!1,fileContentReady:!1}},inject:{user:{default:null},proj:{default:null},repo:{default:null},branchName:{default:null}},methods:{downloadStrAsFile:c,getFileExt:function(e,t){if(void 0===e.children)e.file="unknown",e.path=t+"/"+e.name,-1!==e.name.indexOf(".")&&(e.file=e.name.split(".").pop());else for(var i=0;i<e.children.length;i++)this.getFileExt(e.children[i],t+"/"+e.name)},file2style:function(){if(0===this.tree.length)return"null";var e=this.tree[0].file;return"html"===e?"htmlmixed":"js"===e||"json"===e?"javascript":"md"===e?"markdown":"vue"===e?"vue":"css"===e?"css":"xml"===e?"xml":"c"===e||"cpp"===e||"h"===e?"clike":"py"===e?"python":"null"},onCursorActivity:function(){this.selectedText=this.cmEditor.getSelection()},diagSelected:function(){this.selectedText.length>4096?this.$message({type:"error",message:"文件太长了，AI会罢工的！"}):this.selectedText.length<=10?this.$message({type:"error",message:"代码这么短，怎么诊断嘛"}):(o.set("diag",this.selectedText),window.open("/user/ai/diagnosis","_blank"))},diagWholeFile:function(){this.fileContent.length>4096?this.$message({type:"error",message:"文件太长了，AI会罢工的！"}):(o.set("diag",this.fileContent),window.open("/user/ai/diagnosis","_blank"))},unitTestSelected:function(){this.selectedText.length>4096?this.$message({type:"error",message:"文件太长了，AI会罢工的！"}):this.selectedText.length<=10?this.$message({type:"error",message:"代码这么短，怎么生成嘛"}):(o.set("diag",this.selectedText),window.open("/user/ai/testdata","_blank"))},unitTestWholeFile:function(){this.fileContent.length>4096?this.$message({type:"error",message:"文件太长了，AI会罢工的！"}):(o.set("diag",this.fileContent),window.open("/user/ai/testdata","_blank"))},getTopicColor:r.getDarkColor,getRadialGradient:r.getRadialGradient,getLinearGradient:r.getLinearGradient},created:function(){var e=this;this.fileTreeReady=!1,a.post("/api/develop/getFileTree",{userId:this.user.id,projectId:this.proj.projectId,repoId:this.$route.params.repoid,branch:this.branchName}).then((function(t){if(0===t.data.errcode){console.log(t.data.data),e.items=t.data.data;for(var i=0;i<e.items.length;i++)e.getFileExt(e.items[i],"")}else alert("/api/develop/getFileTree errcode not 0: "+t.data.message)})).catch((function(e){alert("/api/develop/getFileTree error"+e),console.log(e)})).finally((function(){e.fileTreeReady=!0}))},watch:{tree:function(){var e=this;console.log("selected file change!"),void 0!==this.tree[0].file&&(this.fileContentReady=!1,this.cmEditor.setValue("正在努力拉取文件！\n\n选择文件后，可以点击右上角”代码助手“，使用JiHub进行AI代码诊断、生成单元测试、下载文件"),this.cmEditor.setOption("mode",""),a.post("/api/develop/getContent",{userId:this.user.id,projectId:this.proj.projectId,repoId:this.$route.params.repoid,branch:this.branchName,path:this.tree[0].path}).then((function(t){0===t.data.errcode?(console.log(t.data.data),e.fileContent=t.data.data,e.cmEditor.setValue(e.fileContent),e.cmEditor.setOption("mode",e.file2style())):alert("/api/develop/getFileContent errcode not 0: "+t.data.message)})).catch((function(e){alert("/api/develop/getFileContent error"+e),console.log(e)})).finally((function(){e.fileContentReady=!0})))}},mounted:function(){this.cmEditor=d.exports.fromTextArea(this.$refs.cm1,{theme:"idea",lineNumbers:!0,line:!0,readOnly:!0,lineWrapping:!0}),this.cmEditor.on("cursorActivity",this.onCursorActivity)}},u={name:"Branch",components:{FileView:i(t,(function(){var e=this,t=this,i=t._self._c;return i("v-container",[i("v-row",[i("v-col",{attrs:{cols:t.fileContentReady?2:3}},[i("h2",[t._v("文件树")]),i("v-card",{staticClass:"overflow-y-auto",style:t.getLinearGradient(t.user.topic),attrs:{"min-height":"calc(100vh - 300px)","max-height":"calc(100vh - 300px)"}},[t.fileTreeReady?i("v-treeview",{attrs:{items:t.items,activatable:"",active:t.tree,"item-key":"name","open-on-click":"",dense:"","return-object":""},on:{"update:active":function(e){t.tree=e}},scopedSlots:t._u([{key:"prepend",fn:function(e){var o=e.item,r=e.open;return[o.file?i("v-icon",{attrs:{color:t.getTopicColor(t.user.topic)}},[t._v(" "+t._s(void 0!==t.files[o.file]?t.files[o.file]:"mdi-file-document")+" ")]):i("v-icon",{attrs:{color:t.getTopicColor(t.user.topic)}},[t._v(" "+t._s(r?"mdi-folder-open":"mdi-folder")+" ")])]}}],null,!1,2821907853)}):i("v-skeleton-loader",{staticClass:"mt-2",attrs:{type:"list-item-three-line@5"}})],1)],1),i("v-col",{attrs:{cols:t.fileContentReady?7:9}},[i("h2",[i("v-scroll-y-transition",[i("span",[t._v(" "+t._s(t.fileTreeReady?0===t.tree.length?"请选择一个文件":t.fileContentReady?"":"正在努力拉取文件":"文件树加载中，稍侯...")+" ")])]),i("v-scroll-y-transition",[t.fileContentReady?i("a",{directives:[{name:"ripple",rawName:"v-ripple"}],style:"text-decoration: none; color: "+t.getTopicColor(t.user.topic),attrs:{href:"https://github.com/"+t.repo.user+"/"+t.repo.repo+"/blob/"+t.branchName+"/"+t.tree[0].path,target:"_blank"}},[t._v(" "+t._s(t.fileTreeReady?0===t.tree.length?"请选择一个文件":t.fileContentReady?t.repo.repo+t.tree[0].path:"正在努力拉取文件":"文件树加载中，稍侯...")+" ")]):t._e()])],1),i("v-card",{attrs:{"max-height":"calc(100vh - 300px)","min-height":"calc(100vh - 300px)"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:t.fileContent,expression:"fileContent"}],ref:"cm1",staticStyle:{height:"calc(100vh - 300px)",width:"100%"},domProps:{value:t.fileContent},on:{input:function(e){e.target.composing||(t.fileContent=e.target.value)}}})])],1),t.fileContentReady?i("v-col",{attrs:{cols:"3"}},[i("h2",{style:"text-decoration: none; color: "+t.getTopicColor(t.user.topic)},[t._v("代码助手")]),i("v-card",{attrs:{"max-height":"calc(100vh - 300px)","min-height":"calc(100vh - 300px)"}},[i("v-card-title",{style:t.getLinearGradient(t.user.topic)},[i("strong",[t._v("欢迎来到代码助手")])]),i("v-divider"),i("v-card-title",[t._v("单元测试")]),i("v-card-text",[t._v("JiHub可以对您选中的代码，或是整个文件生成单元测试")]),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:t.unitTestSelected}},[i("v-icon",[t._v("mdi-check")]),t._v("对选中代码")],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:t.unitTestWholeFile}},[i("v-icon",[t._v("mdi-check")]),t._v("对整个文件")],1)],1),i("v-divider"),i("v-card-title",[t._v("代码诊断")]),i("v-card-text",[t._v("如果您阅读此代码比较困难，JiHub也很乐意对您选中的代码，或是整个文件进行代码诊断")]),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:t.diagSelected}},[i("v-icon",[t._v("mdi-code-braces")]),t._v("对选中代码")],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:t.diagWholeFile}},[i("v-icon",[t._v("mdi-code-braces")]),t._v("对整个文件")],1)],1),i("v-divider"),i("v-card-text",[t._v("或者如果您想在GitHub操作，或查看源文件？")]),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic),link:"",href:"https://github.com/"+t.repo.user+"/"+t.repo.repo+"/blob/"+t.branchName+"/"+t.tree[0].path,target:"_blank"}},[i("v-icon",[t._v("mdi-github")]),t._v("在GitHub浏览")],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:function(){return t.downloadStrAsFile(t.selectedText,t.user.name+"'s-clip-"+e.tree[0].name)}}},[i("v-icon",[t._v("mdi-download")]),t._v("下载选中代码")],1)],1),i("v-card-actions",[i("v-spacer"),i("v-btn",{attrs:{width:"",outlined:"",color:t.getTopicColor(t.user.topic)},on:{click:function(){return t.downloadStrAsFile(t.fileContent,e.tree[0].name)}}},[i("v-icon",[t._v("mdi-download")]),t._v("下载整个文件")],1)],1),i("v-row",{staticStyle:{height:"5rem"}})],1)],1):t._e()],1)],1)}),[],!1,null,null,null,null).exports},data:function(){return{tabs:null,projId:this.$route.params.projid,repoId:this.$route.params.repoid,branchName:this.$route.params.branchname,proj:null,repos:null,repo:null,branches:null,commitHistory:null,daily:{col:4,color:"#FFCDD2",title:"过去三十日内的提交",label:[],data:[]},monthly:{col:4,color:"#B2EBF2",title:"过去一年内的提交",label:[],data:[]},yearly:{col:4,color:"#C8E6C9",title:"过去十年内的提交",label:[],data:[]},perUser:[],graphReady:!1}},provide:function(){var e=this;return{repo:n((function(){return e.repo})),branchName:n((function(){return e.branchName}))}},created:function(){var e=this;this.proj=this.user.projects.reduce((function(t,i){return i.projectId==e.projId?i:t}),null),null===this.proj&&alert("proj not found"),a.post("/api/develop/getBindRepos",{userId:this.user.id,projectId:this.projId}).then((function(t){0===t.data.errcode?(e.repos=t.data.data.map((function(e,t,i){var o=e.repoRemotePath.split("/");return{id:e.repoId,user:o[0],repo:o[1],intro:e.repoIntroduction}})),e.repo=e.repos.reduce((function(t,i){return i.id==e.repoId?i:t}),null),null===e.repo&&alert("repo not found")):alert("/api/develop/getBindRepos error with not 0 err code ("+t.data.errcode+") "+t.data.message)})).catch((function(e){alert("/api/develop/getBindRepos error"+e)})),a.post("/api/develop/getRepoBranches",{userId:this.user.id,repoId:this.repoId,projectId:this.projId}).then((function(t){0===t.data.errcode?(e.branches=t.data.data.map((function(e,t,i){return e.branchName})),null===e.branches.reduce((function(t,i){return i==e.branchName?i:t}),null)&&alert("branch "+e.branchName+" not found in branches "+e.branches)):alert("/api/develop/getBranches error with not 0 err code ("+t.data.errcode+") "+t.data.message)})).catch((function(e){alert("/api/develop/getBranches error"+e)})),a.post("/api/develop/getCommitHistory",{userId:this.user.id,projectId:this.projId,repoId:this.repoId,branchName:this.branchName}).then((function(t){0===t.data.errcode?(e.commitHistory=t.data.data.map((function(e,t,i){return{id:t,author:e.author,authorEmail:e.authorEmail,commithash:e.commithash,commitMessage:e.commitMessage,commitTime:e.commitTime}})),e.prep_data_in_time_scope(),e.prep_data_in_user_scope(),e.draw_pie_chart(),e.graphReady=!0):alert("/api/develop/getCommitHistory error with not 0 err code ("+t.data.errcode+") "+t.data.message)})).catch((function(e){alert("/api/develop/getCommitHistory error"+e)}))},inject:{user:{default:null}},methods:{prep_data_in_time_scope:function(){var e=this.commitHistory[this.commitHistory.length-1],t=new Date(e.commitTime);t.setDate(t.getDate()-1);for(var i={},o=new Date;o>=t;){var r=t.toLocaleDateString();i[r]=0,t.setDate(t.getDate()+1)}this.commitHistory.forEach((function(e,t,o){var r=new Date(e.commitTime).toLocaleDateString();void 0===i[r]?i[r]=1:i[r]+=1})),this.daily.label=Object.keys(i);for(var a=1;a<this.daily.label.length-1;a++)this.daily.label[a]="";this.daily.data=Object.values(i);var n={};for((t=new Date(e.commitTime)).setMonth(t.getMonth()-1);o>=t;){var l=t.getFullYear()+"-"+(t.getMonth()+1);n[l]=0,t.setMonth(t.getMonth()+1)}this.commitHistory.forEach((function(e,t,i){var o=new Date(e.commitTime).getFullYear()+"-"+(new Date(e.commitTime).getMonth()+1);void 0===n[o]?n[o]=1:n[o]+=1})),this.monthly.label=Object.keys(n),this.monthly.data=Object.values(n);var s={};for((t=new Date(e.commitTime)).setFullYear(t.getFullYear()-1);o>=t;){var c=t.getFullYear();s[c]=0,t.setFullYear(t.getFullYear()+1)}this.commitHistory.forEach((function(e,t,i){var o=new Date(e.commitTime).getFullYear();void 0===s[o]?s[o]=1:s[o]+=1})),this.yearly.label=Object.keys(s),this.yearly.data=Object.values(s)},prep_data_in_user_scope:function(){var e={};for(var t in this.commitHistory.forEach((function(t,i,o){void 0===e[t.author]?e[t.author]=1:e[t.author]+=1})),e)this.perUser.push({key:t,value:e[t]});this.perUser.sort((function(e,t){return t.value-e.value}))},draw_pie_chart:function(){console.log("echarts="),console.log(l);var e=s.exports.init(this.$refs.user_specific_pie_chart);window.addEventListener("resize",(function(){e.resize()})),e.setOption({title:{text:"",left:"center"},legend:{orient:"vertical",left:10,data:this.perUser.label},tooltip:{trigger:"item",formatter:function(e){return e.data.key+" : "+e.data.value+"次"}},series:[{name:"提交次数",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,labelLine:{show:!1},data:this.perUser}]})},getLinearGradient:r.getLinearGradient,getTopicColor:r.getColor,getDarkColor:r.getDarkColor}};e("default",i(u,(function(){var e=this,t=e._self._c;return t("v-container",[t("h1",{style:"color: "+e.getDarkColor(e.user.topic)},[e._v("分支详情 - "+e._s(e.branchName))]),t("v-row",[t("v-col",{attrs:{cols:"12"}},[t("v-tabs",{attrs:{color:e.getDarkColor(e.user.topic),"slider-color":e.getDarkColor(e.user.topic)},model:{value:e.tabs,callback:function(t){e.tabs=t},expression:"tabs"}},[t("v-tab",[e._v("提交记录&统计")]),t("v-tab",{attrs:{disabled:!e.graphReady}},[e._v("查看仓库文件")])],1)],1)],1),t("v-tabs-items",{model:{value:e.tabs,callback:function(t){e.tabs=t},expression:"tabs"}},[t("v-tab-item",{attrs:{value:0}},[t("v-row",[t("v-col",{staticClass:"px-3",attrs:{cols:"3"}},[t("h2",[e._v("提交记录")]),t("v-list",{staticClass:"overflow-y-auto",attrs:{"max-height":"calc(100vh - 250px)"}},e._l(e.commitHistory,(function(i){return t("v-list-item",{key:i.id},[t("v-list-item-content",[t("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(o){var r=o.on,a=o.attrs;return[t("v-list-item-title",e._g(e._b({},"v-list-item-title",a,!1),r),[e._v(e._s(i.commitMessage))])]}}],null,!0)},[t("span",[e._v(e._s(i.commitMessage))])]),t("v-list-item-subtitle",[e._v(e._s(new Date(i.commitTime).toLocaleString())+" - "+e._s(i.commithash.slice(0,6))+" - "+e._s(i.author))])],1)],1)})),1)],1),t("v-divider",{attrs:{vertical:""}}),t("v-col",{attrs:{cols:"9"}},[t("v-container",{attrs:{fluid:""}},[t("v-row",{attrs:{dense:""}},e._l([e.daily,e.monthly,e.yearly],(function(i,o){return t("v-col",{key:o,attrs:{cols:i.col}},[t("v-card",{staticClass:"text-center align-center",attrs:{color:i.color}},[t("v-sparkline",{attrs:{labels:i.label,value:i.data,"auto-line-width":"",smooth:"",padding:"20","stroke-linecap":"round","show-labels":"","auto-draw":""}}),t("v-card-title",[e._v("从 "+e._s(i.label[0])+" 到 "+e._s(i.label[i.label.length-1])+" 的提交")])],1)],1)})),1),t("br"),t("v-divider"),t("br"),t("v-row",{attrs:{dense:""}},[t("v-col",{attrs:{cols:"12"}},[t("v-card",{style:e.getLinearGradient(e.user.topic)},[t("v-container",{attrs:{fluid:""}},[t("v-row",[t("v-col",{attrs:{cols:"8"}},[t("div",{ref:"user_specific_pie_chart",staticClass:"indigo lighten-4",staticStyle:{height:"20em"}})]),t("v-col",{attrs:{cols:"4"}},[t("v-list",{staticClass:"overflow-y-auto",attrs:{dense:"","max-height":"20em"}},e._l(e.perUser,(function(i){return t("v-list-item",{key:i.key},[t("v-list-item-content",[t("v-list-item-title",[e._v(e._s(i.key))]),t("v-list-item-subtitle",[e._v(e._s(i.value)+" 次提交")])],1)],1)})),1)],1)],1)],1),t("v-card-title",[e._v("用户提交数量")])],1)],1)],1)],1)],1)],1)],1),t("v-tab-item",{attrs:{value:1}},[t("FileView")],1)],1)],1)}),[],!1,null,"2addfc7c",null,null).exports)}}}));
