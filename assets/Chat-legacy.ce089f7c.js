!function(){function t(t,o){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var s,n,r,i,l=[],c=!0,a=!1;try{if(r=(o=o.call(t)).next,0===e){if(Object(o)!==o)return;c=!1}else for(;!(c=(s=r.call(o)).done)&&(l.push(s.value),l.length!==e);c=!0);}catch(u){a=!0,n=u}finally{try{if(!c&&null!=o.return&&(i=o.return(),Object(i)!==i))return}finally{if(a)throw n}}return l}}(t,o)||function(t,o){if(!t)return;if("string"==typeof t)return e(t,o);var s=Object.prototype.toString.call(t).slice(8,-1);"Object"===s&&t.constructor&&(s=t.constructor.name);if("Map"===s||"Set"===s)return Array.from(t);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return e(t,o)}(t,o)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,s=new Array(e);o<e;o++)s[o]=t[o];return s}System.register(["./index-legacy.e23305fa.js"],(function(e,o){"use strict";var s,n=document.createElement("style");return n.textContent="",document.head.appendChild(n),{setters:[function(t){s=t.n}],execute:function(){e("default",s({name:"Chat",data:function(){return{selectedRoom:0,messageInput:"",chatRooms:[]}},created:function(){this.updateChatRooms()},inject:{user:{default:null}},methods:{updateChatRooms:function(){var e=this;console.log("updating chat rooms...");var o={};this.chatRooms.forEach((function(t,e){null!==t.ws&&(o[t.id]=t.ws)})),this.chatRooms=[{id:1,title:"room1",history:[]}],this.chatRooms.forEach((function(t,s){void 0!==o[t.id]?(t.ws=o[t.id],o[t.id]=void 0):t.ws=e.initWS(t.id)}));for(var s=0,n=Object.entries(o);s<n.length;s++){var r=t(n[s],2);r[0];r[1].close()}},initWS:function(t){var e=this;console.log("initWS: connecting to ws://104.208.78.33:8000/ws/chat/"+this.user.id.toString()+"/"+t.toString());var o=new WebSocket("ws://104.208.78.33:8000/ws/chat/"+this.user.id.toString()+"/"+t.toString());o.onopen=function(t){o.send(JSON.stringify({sender:e.user.id,type:1,message:e.user.name+" has joined the group chat!"}))};return o.onmessage=function(t){console.log("Message from server ",t.data);var o,s,n,r=JSON.parse(t.data);o=r.senderName,r.senderId,s=r.content,n=r.time,e.chatRooms[e.selectedRoom].history.push({from:o,type:"group",content:s,time:n})},o.onerror=function(t){console.error("WebSocket error observed:",t)},o.onclose=function(t){console.log("Socket is closed.",t.reason)},o},sendMsg:function(){console.log("will send: "+this.messageInput),this.chatRooms[this.selectedRoom].ws.send(JSON.stringify({sender:this.user.id,type:1,message:this.messageInput})),this.messageInput=""}}},(function(){var t=this,e=t._self._c;return e("v-container",{attrs:{fluid:""}},[e("h1",[t._v("聊天室")]),e("v-row",[e("v-col",{attrs:{cols:"4"}},[e("p",[t._v("selected room: "+t._s(t.selectedRoom))]),e("v-list",[e("v-list-item-group",{attrs:{mandatory:""},model:{value:t.selectedRoom,callback:function(e){t.selectedRoom=e},expression:"selectedRoom"}},t._l(t.chatRooms,(function(o){return e("v-list-item",{key:o.id},[e("v-list-item-title",[t._v(t._s(o.title))]),e("v-list-item-subtitle",[t._v(t._s(0===o.history.length?"还没有消息哦":o.history[o.history.length-1].content))])],1)})),1)],1)],1),e("v-col",{attrs:{cols:"8"}},[e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card",[e("v-card-title",{staticClass:"v-app-bar-title"},[t._v(t._s(t.chatRooms[t.selectedRoom].title))]),e("v-card-subtitle",[1===this.chatRooms[this.selectedRoom].ws.readyState?e("v-icon",{staticClass:"green--text"},[t._v("mdi-circle")]):e("v-icon",{staticClass:"yellow--text"},[t._v("mdi-circle")]),t._v(" ws://104.208.78.33:8000/ws/chat/11/1 ")],1)],1)],1)],1),e("v-row",[e("v-col",{attrs:{cols:"12"}},[e("v-card",[e("v-card-text",[e("v-list",{staticClass:"overflow-auto scroll-y",attrs:{"min-height":"600","max-height":"600"}},[e("v-list-item-group",t._l(t.chatRooms[t.selectedRoom].history,(function(o){return e("v-list-item",{key:o.id},[e("v-list-item-title",[t._v(t._s(o.from)+" : "+t._s(o.content))])],1)})),1)],1)],1)],1)],1)],1),e("v-row",[e("v-col",{attrs:{cols:"10"}},[e("v-text-field",{attrs:{label:"输入消息"},model:{value:t.messageInput,callback:function(e){t.messageInput=e},expression:"messageInput"}})],1),e("v-col",{attrs:{cols:"2"}},[e("v-btn",{attrs:{block:""},on:{click:t.sendMsg}},[t._v("SEND")])],1)],1)],1)],1)],1)}),[],!1,null,"e00d9120",null,null).exports)}}}))}();
